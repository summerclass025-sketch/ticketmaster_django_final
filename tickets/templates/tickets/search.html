<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Ticketmaster</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    .results-header{
      background:#fff;border:1px solid #e5e7eb;border-radius:.75rem;
      box-shadow:0 1px 2px rgba(0,0,0,.06);
    }
    .result-card{
      background:#fff;border:1px solid #e5e7eb;border-radius:.75rem;
      box-shadow:0 2px 6px rgba(0,0,0,.08);
    }
    .event-img{
      width:100%;height:160px;object-fit:cover;border-radius:.5rem;
    }
    .result-card h5{
      font-size:1.18rem;font-weight:600;line-height:1.25;margin-bottom:.35rem;
    }
    .venue-line{
      color:#6c757d;font-size:.95rem;margin-bottom:.25rem;
      display:flex;align-items:center;gap:.35rem;
    }
    .venue-line i{color:#6c757d;font-size:1.05rem;line-height:1;}
    .address{font-size:.85rem;color:#868e96;}
    .event-when .date{font-weight:600;color:#212529;font-size:.95rem;}
    .event-when .time{color:#212529;font-size:.85rem;}
    .btn-sm{font-size:.8rem;padding:.25rem .55rem}

    @media (max-width:767.98px){
      .result-card .col-md-6{margin-top:.25rem}
      .event-img{height:185px}
    }

    /* ---------------- DARK MODE ---------------- */
    .dark-mode {
      background-color: #121212 !important;
      color: white !important;
    }

    .dark-mode .result-card,
    .dark-mode .results-header {
      background-color: #1f1f1f !important;
      color: white !important;
      border-color: #333 !important;
    }

    .dark-mode .venue-line,
    .dark-mode .address {
      color: #ccc !important;
    }

    .dark-mode .event-when .date,
    .dark-mode .event-when .time {
      color: #ddd !important;
    }

    .dark-mode .bg-dark {
      background-color: #000 !important;
    }
  </style>
</head>

<body class="bg-light">

  <!-- Top controls: Dark mode + View Favorites -->
  <div class="container mt-3 text-center">
    <button id="toggleDark" class="btn btn-secondary me-2">Dark Mode</button>
    <a href="{% url 'favorites_list' %}" class="btn btn-outline-dark ms-2">
      View Favorites
    </a>
  </div>

  <!-- TOP SECTION -->
  <div class="container-fluid bg-dark text-white py-5 mt-3">
    <div class="row justify-content-center">
      <div class="col-12 col-lg-8 text-center">
        <h1 class="display-5 fw-semibold mb-2">Ticketmaster</h1>
        <p class="lead mb-4">Quickly find tickets around you</p>

        <!-- Search form -->
        <form method="get" class="d-flex gap-2 justify-content-center flex-column flex-md-row">
          <!-- Categories -->
          <div class="flex-fill">
            <label for="category" class="visually-hidden">Category</label>
            <input
              class="form-control"
              list="categories"
              id="category"
              name="category"
              placeholder="Type to search by genre"
              value="{{ category }}">
            <datalist id="categories">
              <option value="Music">
              <option value="Sports">
              <option value="Theater">
              <option value="Family">
              <option value="Arts &amp; Theater">
              <option value="Concerts">
              <option value="Comedy">
              <option value="Dance">
            </datalist>
          </div>

          <!-- City -->
          <div class="flex-fill">
            <label for="city" class="visually-hidden">City</label>
            <input
              id="city"
              name="city"
              type="text"
              class="form-control"
              placeholder="Enter a city e.g., Hartford"
              value="{{ city }}">
          </div>

          <!-- Search button -->
          <div>
            <button type="submit" class="btn btn-primary px-4">SEARCH</button>
          </div>
        </form>

        <!-- Error alert -->
        {% if error_message %}
          <div id="alertBox" class="alert alert-danger mt-3" role="alert">
            {{ error_message }}
          </div>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- RESULTS -->
  <div class="container bg-light text-dark py-5 rounded-top">
    <div id="results" class="row g-3">

      {% if events %}
        <!-- Summary header -->
        <div class="col-12">
          <div class="results-header px-3 py-2 mb-3">
            <span class="fw-semibold text-secondary">
              {{ shown|default:0 }} of {{ total_found|default:0 }} events found
            </span>
          </div>
        </div>

        <!-- Event cards -->
        {% for ev in events %}
          <div class="col-12">
            <div class="result-card px-3 py-3 mb-3">
              <div class="row g-3 align-items-start">
                <div class="col-12 col-md-3">
                  <img src="{{ ev.image_url }}" alt="Event image" class="event-img img-fluid">
                </div>

                <div class="col-12 col-md-6">
                  <h5>{{ ev.name }}</h5>
                  <div class="venue-line">
                    <i class="bi bi-geo-alt-fill"></i>
                    <span class="fw-semibold">{{ ev.venue_name }}</span>
                  </div>
                  {% if ev.full_addr %}
                    <div class="address">{{ ev.full_addr }}</div>
                  {% endif %}
                </div>

                <div class="col-12 col-md-3 d-flex flex-column align-items-md-end">
                  <div class="event-when text-md-end">
                    <div class="date">{{ ev.nice_date }}</div>
                    {% if ev.nice_time %}
                      <div class="time">{{ ev.nice_time }}</div>
                    {% endif %}
                  </div>

                  <!-- Find tickets button -->
                  <a class="btn btn-sm btn-outline-primary mt-2 align-self-md-end"
                     href="{{ ev.ticket_url }}" target="_blank" rel="noopener">
                    Find tickets
                  </a>

                  <!-- Add to Favorites button (CRUD: Create) -->
                  <form method="post" action="{% url 'add_favorite' %}" class="mt-2 align-self-md-end">
                    {% csrf_token %}
                    <input type="hidden" name="name" value="{{ ev.name }}">
                    <input type="hidden" name="venue" value="{{ ev.venue_name }}">
                    <input type="hidden" name="date" value="{{ ev.nice_date }}">
                    <input type="hidden" name="ticket_url" value="{{ ev.ticket_url }}">
                    <input type="hidden" name="notes" value="">
                    <button type="submit" class="btn btn-sm btn-success">
                      Add to Favorites
                    </button>
                  </form>
                </div>
              </div>
            </div>
          </div>
        {% endfor %}

      {% elif category or city %}
        <!-- No results after a search -->
        <p class="text-center text-muted mb-0">No results found.</p>
      {% endif %}

    </div>
  </div>

  <!-- Bootstrap JS Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Dark mode toggle script -->
  <script>
    const toggleBtn = document.getElementById("toggleDark");
    if (toggleBtn) {
      toggleBtn.addEventListener("click", function () {
        document.body.classList.toggle("dark-mode");
      });
    }
  </script>
</body>
</html>
